{% extends "base.html" %}

{% block title %}å•é¡Œã«å›ç­” - ä¸ƒå¤¢å­¦ç¿’ã‚¢ãƒ—ãƒª{% endblock %}

{% block content %}
<div class="page-header">
    <h1 class="page-title">ğŸ“¬ å…ˆç”Ÿã‹ã‚‰ã®å•é¡Œ</h1>
    <a href="{{ url_for('japanese_dashboard') }}" class="btn btn-secondary btn-sm">â† æˆ»ã‚‹</a>
</div>

<div class="card">
    <!-- å•é¡Œ -->
    <div style="text-align: center; margin-bottom: 24px;">
        <div style="font-size: 4rem; color: var(--primary); margin-bottom: 16px;">{{ quiz.word }}</div>
        <p style="color: var(--text-muted);">ã“ã®æ¼¢å­—ã®èª­ã¿æ–¹ã¯ï¼Ÿ</p>
    </div>

    <!-- é¸æŠè‚¢ -->
    <div id="options" style="display: grid; grid-template-columns: 1fr 1fr; gap: 12px;">
        {% for option in options %}
        <button class="btn btn-secondary option-btn"
            onclick="checkAnswer('{{ option }}', '{{ quiz.correct_reading }}', {{ assignment.id }})"
            style="padding: 16px; font-size: 1.2rem;">
            {{ option }}
        </button>
        {% endfor %}
    </div>

    <!-- çµæœè¡¨ç¤º -->
    <div id="result" style="display: none; text-align: center; margin-top: 24px;">
        <div id="result-icon" style="font-size: 4rem;"></div>
        <div id="result-text" style="font-size: 1.3rem; margin-top: 12px;"></div>
        <div style="margin-top: 16px; padding: 16px; background: var(--bg-hover); border-radius: 12px;">
            <div><strong>æ­£è§£ï¼š</strong> {{ quiz.correct_reading }}</div>
            <div style="margin-top: 8px;">ğŸ‡¨ğŸ‡³ {{ quiz.meaning_chinese }}</div>
            <div style="margin-top: 8px; color: var(--text-muted);">ğŸ“ {{ quiz.example }}</div>
        </div>
        <a href="{{ url_for('japanese_dashboard') }}" class="btn btn-primary btn-block" style="margin-top: 20px;">
            ğŸ“¬ å•é¡Œä¸€è¦§ã«æˆ»ã‚‹
        </a>
    </div>
</div>

<script>
    let answered = false;

    function checkAnswer(selected, correct, assignmentId) {
        if (answered) return;
        answered = true;

        const isCorrect = selected === correct;

        // ãƒœã‚¿ãƒ³è‰²ã‚’å¤‰ãˆã‚‹
        document.querySelectorAll('.option-btn').forEach(btn => {
            btn.disabled = true;
            if (btn.textContent.trim() === correct) {
                btn.style.background = 'linear-gradient(135deg, #4caf50, #8bc34a)';
                btn.style.color = 'white';
            } else if (btn.textContent.trim() === selected && !isCorrect) {
                btn.style.background = 'linear-gradient(135deg, #f44336, #e53935)';
                btn.style.color = 'white';
            }
        });

        // çµæœè¡¨ç¤º
        const resultEl = document.getElementById('result');
        const iconEl = document.getElementById('result-icon');
        const textEl = document.getElementById('result-text');

        resultEl.style.display = 'block';

        if (isCorrect) {
            iconEl.textContent = 'ğŸ‰';
            textEl.textContent = 'æ­£è§£ã§ã™ï¼ã™ã”ã„ï¼';
            textEl.style.color = '#4caf50';
        } else {
            iconEl.textContent = 'ğŸ˜¢';
            textEl.textContent = 'æ®‹å¿µ...ã‚‚ã†ä¸€åº¦è¦šãˆã‚ˆã†ï¼';
            textEl.style.color = '#f44336';
        }

        // ã‚µãƒ¼ãƒãƒ¼ã«å›ç­”ã‚’é€ä¿¡
        fetch('/japanese/assigned/answer', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({
                assignment_id: assignmentId,
                is_correct: isCorrect
            })
        });
    }
</script>
{% endblock %}