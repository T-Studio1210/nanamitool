{% extends "base.html" %}

{% block title %}ç”Ÿå¾’ç®¡ç† - çŸ³å·ä¸ƒå¤¢è¬›å¸«å°‚ç”¨å­¦ç¿’ã‚¢ãƒ—ãƒª{% endblock %}

{% block content %}
<div class="fade-in">
    <div class="page-header">
        <h1 class="page-title">ğŸ‘¥ ç”Ÿå¾’ç®¡ç†</h1>
    </div>

    <!-- ç”Ÿå¾’è¿½åŠ ãƒ•ã‚©ãƒ¼ãƒ  -->
    <div class="card" style="margin-bottom: 1.5rem;">
        <h2 class="card-title">â• æ–°ã—ã„ç”Ÿå¾’ã‚’è¿½åŠ </h2>
        <form method="POST" action="{{ url_for('add_student') }}">
            <div style="display: grid; grid-template-columns: 1fr 1fr 1fr auto; gap: 1rem; align-items: end;">
                <div class="form-group" style="margin-bottom: 0;">
                    <label class="form-label" for="username">ãƒ¦ãƒ¼ã‚¶ãƒ¼åï¼ˆãƒ­ã‚°ã‚¤ãƒ³ç”¨ï¼‰</label>
                    <input type="text" id="username" name="username" class="form-input" placeholder="ä¾‹: tanaka"
                        required>
                </div>
                <div class="form-group" style="margin-bottom: 0;">
                    <label class="form-label" for="display_name">è¡¨ç¤ºå</label>
                    <input type="text" id="display_name" name="display_name" class="form-input" placeholder="ä¾‹: ç”°ä¸­å¤ªéƒ"
                        required>
                </div>
                <div class="form-group" style="margin-bottom: 0;">
                    <label class="form-label" for="password">ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰</label>
                    <input type="password" id="password" name="password" class="form-input" placeholder="ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰"
                        required>
                </div>
                <button type="submit" class="btn btn-primary">è¿½åŠ </button>
            </div>
            <div style="margin-top: 12px;">
                <label style="display: flex; align-items: center; gap: 8px; cursor: pointer;">
                    <input type="checkbox" name="is_chinese_student" value="1" style="width: 18px; height: 18px;">
                    <span>ğŸ‡¨ğŸ‡³ ä¸­å›½äººç”Ÿå¾’ï¼ˆæ—¥æœ¬èªå­¦ç¿’æ©Ÿèƒ½ã‚’æœ‰åŠ¹ã«ã™ã‚‹ï¼‰</span>
                </label>
            </div>
        </form>
    </div>

    <!-- ç”Ÿå¾’ä¸€è¦§ -->
    <div class="card">
        <h2 class="card-title">ğŸ“‹ ç™»éŒ²æ¸ˆã¿ã®ç”Ÿå¾’ ({{ students|length }}å)</h2>

        {% if students %}
        <table style="width: 100%; border-collapse: collapse;">
            <thead>
                <tr style="border-bottom: 1px solid var(--border);">
                    <th style="text-align: left; padding: 0.75rem; color: var(--text-secondary);">è¡¨ç¤ºå</th>
                    <th style="text-align: left; padding: 0.75rem; color: var(--text-secondary);">ãƒ¦ãƒ¼ã‚¶ãƒ¼å</th>
                    <th style="text-align: left; padding: 0.75rem; color: var(--text-secondary);">ã‚¿ã‚¤ãƒ—</th>
                    <th style="text-align: left; padding: 0.75rem; color: var(--text-secondary);">å›ç­”æ•°</th>
                    <th style="text-align: left; padding: 0.75rem; color: var(--text-secondary);">ç™»éŒ²æ—¥</th>
                    <th style="text-align: right; padding: 0.75rem;"></th>
                </tr>
            </thead>
            <tbody>
                {% for student in students %}
                <tr style="border-bottom: 1px solid var(--border);">
                    <td style="padding: 0.75rem;">{{ student.display_name }}</td>
                    <td style="padding: 0.75rem; color: var(--text-secondary);">{{ student.username }}</td>
                    <td style="padding: 0.75rem;">
                        {% if student.is_chinese_student %}
                        <span class="status-badge" style="background: #e3f2fd; color: #1976d2;">ğŸ‡¨ğŸ‡³ ä¸­å›½äºº</span>
                        {% else %}
                        <span class="status-badge">é€šå¸¸</span>
                        {% endif %}
                    </td>
                    <td style="padding: 0.75rem;">
                        <span class="status-badge status-submitted">{{ student.answers.count() }}ä»¶</span>
                    </td>
                    <td style="padding: 0.75rem; color: var(--text-muted);">{{ student.created_at|jst('%Y/%m/%d')
                        }}</td>
                    <td style="padding: 0.75rem; text-align: right;">
                        <!-- ä¸­å›½äººç”Ÿå¾’åˆ‡ã‚Šæ›¿ãˆãƒœã‚¿ãƒ³ -->
                        <form method="POST" action="{{ url_for('toggle_chinese_student', student_id=student.id) }}"
                            style="display: inline;">
                            <button type="submit" class="btn btn-secondary btn-sm" style="margin-right: 0.5rem;">
                                {% if student.is_chinese_student %}ğŸ‡¯ğŸ‡µ è§£é™¤{% else %}ğŸ‡¨ğŸ‡³ æœ‰åŠ¹åŒ–{% endif %}
                            </button>
                        </form>
                        <a href="{{ url_for('student_progress', student_id=student.id) }}"
                            class="btn btn-secondary btn-sm" style="margin-right: 0.5rem;">
                            ğŸ“Š è©³ç´°
                        </a>
                        <form method="POST" action="{{ url_for('delete_student', student_id=student.id) }}"
                            style="display: inline;">
                            <button type="submit" class="btn btn-danger btn-sm"
                                onclick="return confirmDelete('{{ student.display_name }}ã•ã‚“ã‚’å‰Šé™¤ã—ã¾ã™ã‹ï¼Ÿé–¢é€£ã™ã‚‹ã™ã¹ã¦ã®å›ç­”ã‚‚å‰Šé™¤ã•ã‚Œã¾ã™ã€‚')">
                                ğŸ—‘ï¸ å‰Šé™¤
                            </button>
                        </form>
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
        {% else %}
        <div class="empty-state">
            <div class="empty-icon">ğŸ‘¥</div>
            <p>ç™»éŒ²ã•ã‚Œã¦ã„ã‚‹ç”Ÿå¾’ãŒã„ã¾ã›ã‚“ã€‚</p>
            <p style="margin-top: 0.5rem; font-size: 0.875rem;">ä¸Šã®ãƒ•ã‚©ãƒ¼ãƒ ã‹ã‚‰ç”Ÿå¾’ã‚’è¿½åŠ ã—ã¦ãã ã•ã„ã€‚</p>
        </div>
        {% endif %}
    </div>
</div>
{% endblock %}