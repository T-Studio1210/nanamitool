{% extends "base.html" %}

{% block title %}{{ student.display_name }}ã®å­¦ç¿’çŠ¶æ³ - çŸ³å·ä¸ƒå¤¢è¬›å¸«å°‚ç”¨å­¦ç¿’ã‚¢ãƒ—ãƒª{% endblock %}

{% block content %}
<div class="fade-in">
    <div class="page-header">
        <h1 class="page-title">ğŸ“Š {{ student.display_name }}ã®å­¦ç¿’çŠ¶æ³</h1>
        <a href="{{ url_for('manage_students') }}" class="btn btn-secondary">â† ç”Ÿå¾’ä¸€è¦§ã«æˆ»ã‚‹</a>
    </div>

    <!-- çµ±è¨ˆã‚µãƒãƒªãƒ¼ -->
    <div class="stats-grid" style="margin-bottom: 1.5rem;">
        <!-- å®Œäº†ç‡ãƒ—ãƒ­ã‚°ãƒ¬ã‚¹ãƒãƒ¼ -->
        <div class="stat-card" style="grid-column: span 2;">
            <div class="stat-icon" style="background: linear-gradient(135deg, #e91e8c, #ff6b9d);">ğŸ“ˆ</div>
            <div style="width: 100%;">
                <div style="display: flex; justify-content: space-between; align-items: center;">
                    <div class="stat-label">å­¦ç¿’é€²æ—</div>
                    <div class="stat-value" style="font-size: 1.5rem;">{{ stats.completion_rate }}%</div>
                </div>
                <div
                    style="width: 100%; height: 16px; background: #eee; border-radius: 8px; margin-top: 10px; overflow: hidden;">
                    <div
                        style="width: {{ stats.completion_rate }}%; height: 100%; background: linear-gradient(90deg, #e91e8c, #ff6b9d); transition: width 0.5s;">
                    </div>
                </div>
                <div style="font-size: 0.85rem; color: #666; margin-top: 8px;">
                    {{ stats.answered }} / {{ stats.total }} å• å®Œäº†
                </div>
            </div>
        </div>

        <!-- å›ç­”æ¸ˆã¿ -->
        <div class="stat-card">
            <div class="stat-icon" style="background: #4caf50;">âœ…</div>
            <div>
                <div class="stat-label">å›ç­”æ¸ˆã¿</div>
                <div class="stat-value">{{ stats.answered }}</div>
            </div>
        </div>

        <!-- æœªå›ç­” -->
        <div class="stat-card">
            <div class="stat-icon" style="background: #ff9800;">â³</div>
            <div>
                <div class="stat-label">æœªå›ç­”</div>
                <div class="stat-value">{{ stats.unanswered }}</div>
            </div>
        </div>

        <!-- ãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒƒã‚¯æ¸ˆã¿ -->
        <div class="stat-card">
            <div class="stat-icon" style="background: #2196f3;">ğŸ’¬</div>
            <div>
                <div class="stat-label">FBæ¸ˆã¿</div>
                <div class="stat-value">{{ stats.with_feedback }}</div>
            </div>
        </div>

        <!-- ç¢ºèªå¾…ã¡ -->
        <div class="stat-card">
            <div class="stat-icon" style="background: #9c27b0;">ğŸ“¤</div>
            <div>
                <div class="stat-label">ç¢ºèªå¾…ã¡</div>
                <div class="stat-value">{{ stats.pending_feedback }}</div>
            </div>
        </div>
    </div>

    <!-- å•é¡Œåˆ¥è©³ç´° -->
    <div class="card">
        <h2 class="card-title">ğŸ“‹ å•é¡Œåˆ¥ã®é€²æ—</h2>

        {% if problem_stats %}
        <div class="problem-list">
            {% for item in problem_stats %}
            <div class="problem-card"
                style="cursor: default; {% if item.status == 'feedback_received' %}border-left: 4px solid #4caf50;{% elif item.status == 'answered' %}border-left: 4px solid #ff9800;{% else %}border-left: 4px solid #e0e0e0;{% endif %}">
                <div class="problem-header">
                    <h3 class="problem-title">{{ item.problem.title }}</h3>
                    <div style="display: flex; align-items: center; gap: 0.5rem; flex-wrap: wrap;">
                        <!-- ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ãƒãƒƒã‚¸ -->
                        {% if item.status == 'feedback_received' %}
                        <span class="status-badge status-reviewed">âœ“ ãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒƒã‚¯æ¸ˆã¿</span>
                        {% if item.feedback_status.score is not none %}
                        <span class="status-badge" style="background: #e3f2fd; color: #1976d2;">{{
                            item.feedback_status.score }}ç‚¹</span>
                        {% endif %}
                        {% elif item.status == 'answered' %}
                        <span class="status-badge status-pending">â³ ç¢ºèªå¾…ã¡</span>
                        {% else %}
                        <span class="status-badge" style="background: #eee; color: #999;">ğŸ“ æœªå›ç­”</span>
                        {% endif %}

                        <span class="problem-date">{{ item.problem.created_at|jst('%Y/%m/%d') }}</span>
                    </div>
                </div>

                <div style="display: flex; justify-content: space-between; align-items: center; margin-top: 0.5rem;">
                    <div class="problem-preview" style="margin: 0; flex: 1;">{{
                        item.problem.content|striptags|truncate(60) }}</div>

                    {% if item.answer %}
                    <a href="{{ url_for('view_answer', answer_id=item.answer.id) }}" class="btn btn-secondary btn-sm">
                        å›ç­”ã‚’è¦‹ã‚‹ â†’
                    </a>
                    {% endif %}
                </div>
            </div>
            {% endfor %}
        </div>
        {% else %}
        <div class="empty-state">
            <div class="empty-icon">ğŸ“­</div>
            <p>ã¾ã å•é¡ŒãŒå‰²ã‚Šå½“ã¦ã‚‰ã‚Œã¦ã„ã¾ã›ã‚“ã€‚</p>
        </div>
        {% endif %}
    </div>
</div>
{% endblock %}